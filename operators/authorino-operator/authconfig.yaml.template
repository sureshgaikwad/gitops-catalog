apiVersion: authorino.kuadrant.io/v1beta3
kind: AuthConfig
metadata:
  name: vllm-mistral-protection
  namespace: models
  annotations:
    argocd.argoproj.io/sync-wave: "2"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
  labels:
    app: vllm-mistral-7b
    auth-provider: authorino
spec:
  hosts:
  - "vllm-mistral-7b.models.svc.cluster.local"
  authentication:
    "api-key-auth":
      apiKey:
        selector:
          matchLabels:
            app: vllm-auth
        allNamespaces: true
      credentials:
        authorizationHeader:
          prefix: "Bearer "
  authorization:
    "allow-authenticated":
      opa:
        rego: |
          allow := true
  response:
    success:
      headers:
        "x-auth-service":
          value: "authorino"
        "x-auth-user":
          value: "lightspeed-service"
